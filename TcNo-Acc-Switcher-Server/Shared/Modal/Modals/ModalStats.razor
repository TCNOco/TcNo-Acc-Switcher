@*TcNo Account Switcher - A Super fast account switcher
    Copyright (C) 2019-2022 TechNobo (Wesley Pyburn)
    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.
    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses />.*@

@using TcNo_Acc_Switcher_Server.State
@using TcNo_Acc_Switcher_Server.State.Interfaces
@inject Modals Modals
@inject ILang Lang
@inject IStatistics Statistics
@inject IWindowSettings WindowSettings

@code {
    protected override void OnInitialized()
    {
        Modals.Title = Lang["Modal_Title_Stats"];
        Statistics.GenerateTotals();
        Statistics.Save();
    }
}

<div class="infoWindow">
    <div class="fullWidthContent">
        <div style="text-align:left"><p>
            @if (!WindowSettings.CollectStats)
            {
                @Lang["Stats_Disabled"];
            }
            else
            {
                <h3>TcNo Account Switcher Stats - @DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")</h3><br />
                @if (WindowSettings.ShareAnonymousStats)
                {
                    @(new MarkupString(Lang["Stats_ShareEnabled", new {WebsiteLink = "OpenLinkInBrowser('https://tcno.co/Projects/AccSwitcher/stats/')"}]))
                }
                else
                {
                    @(new MarkupString(Lang["Stats_ShareDisabled", new { WebsiteLink = "https://tcno.co/Projects/AccSwitcher/stats/" }]))
                }
                <div class="statSection">
                    <span><b>@Lang["Stats_OperatingSystem"]</b>@Statistics.OperatingSystem</span>
                    <span><b>@Lang["Stats_FirstLaunch"]</b>@Statistics.FirstLaunch.ToString("yyyy-MM-dd HH:mm:ss")</span>
                    <span><b>@Lang["Stats_LaunchCount"]</b>@Statistics.LaunchCount</span>
                    <span><b>@Lang["Stats_CrashCount"]</b>@Statistics.CrashCount</span>
                    <span><b>@Lang["Stats_MostUsedPlatform"]</b>@Statistics.MostUsedPlatform</span>
                    <span><b>@Lang["Stats_TotalTime"]</b>@TimeSpan.FromSeconds(Statistics.PageStats["_Total"].TotalTime).ToString("hh\\:mm\\:ss")</span>
                    <span><b>@Lang["Stats_TotalSwitches"]</b>@Statistics.SwitcherStats["_Total"].Switches</span>
                    <span><b>@Lang["Stats_TotalGamesLaunched"]</b>@Statistics.SwitcherStats["_Total"].GamesLaunched</span>
                    <span><b>@Lang["Stats_UniqueDaysLong"]</b>@Statistics.SwitcherStats["_Total"].UniqueDays</span>
                </div>
                <h4>@Lang["Stats_InDepth"]</h4>
                <div class="statSection">
                    <span><b>Uuid</b>: @Statistics.Uuid</span>
                    <span><b>@Lang["Stats_LastUpload"]</b>@Statistics.LastUpload.ToString("yyyy-MM-dd HH:mm:ss")</span>
                    @if (Statistics.SwitcherStats.Count > 1)
                    {
                        <span><b>@Lang["Stats_SwitcherStats"]</b></span>
                    }

                    @foreach (var switcherStat in Statistics.SwitcherStats.Where(switcherStat => switcherStat.Key != "_Total"))
                    {
                        <b>- @switcherStat.Key: </b>
                        <div class="statIndent">
                            <span><b>- @Lang["Stats_Accounts"]</b>@switcherStat.Value.Accounts</span>
                            <span><b>- @Lang["Stats_Switches"]</b>@switcherStat.Value.Switches</span>
                            <span><b>- @Lang["Stats_FirstActive"]</b>@switcherStat.Value.FirstActive.ToString("yyyy-MM-dd HH:mm:ss")</span>
                            <span><b>- @Lang["Stats_LastActive"]</b>@switcherStat.Value.LastActive.ToString("yyyy-MM-dd HH:mm:ss")</span>
                            <span><b>- @Lang["Stats_UniqueDays"]</b>@switcherStat.Value.UniqueDays</span>
                            <span><b>- @Lang["Stats_GameShortcuts"]</b>@switcherStat.Value.GameShortcuts</span>
                            <span><b>- @Lang["Stats_GameShortcutsHotbar"]</b>@switcherStat.Value.GameShortcutsHotbar</span>
                            <span><b>- @Lang["Stats_GamesLaunched"]</b>@switcherStat.Value.GamesLaunched</span>
                        </div>
                    }
                    @if (Statistics.PageStats.Count > 1){
                        <b>@Lang["Stats_PageStats"]</b><br />
                    }
                    <div class="statIndent">
                        @foreach (var pageStat in Statistics.PageStats.Where(pageStat => pageStat.Key != "_Total"))
                        {
                            <span><b>- @pageStat.Key: </b>@Lang["Stats_VisitsTotalTime", new { visits = pageStat.Value.Visits, hours = TimeSpan.FromSeconds(pageStat.Value.TotalTime).ToString("hh\\:mm\\:ss")}]</span>
                        }
                    </div>
                </div>
            }
        </p></div>
    </div>
</div>